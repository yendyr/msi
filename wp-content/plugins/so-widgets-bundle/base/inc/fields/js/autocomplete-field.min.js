!function(e){e(document).on("sowsetupformfield",".siteorigin-widget-field-type-autocomplete",(function(t){var i=e(this);if(!i.data("initialized")){var n=function(){var e=i.find("input.siteorigin-widget-input").val();return 0===e.length?[]:e.split(",")},s=function(){var t=n();i.find("ul.items > li").each((function(i,n){var s=e(this);t.indexOf(s.data("value"))>-1?s.addClass("selected"):s.removeClass("selected")}))},a=function(){var t=i.find(".content-text-search"),n=t.val(),s=t.data("source"),a=t.data("postTypes"),o={action:"so_widgets_search_"+s};"posts"===s?(o.query=n,o.postTypes=a):"terms"===s&&(o.term=n);var l=i.find("ul.items").empty().addClass("loading");return e.get(soWidgets.ajaxurl,o,(function(t){t.forEach((function(t){""===t.label&&(t.label="&nbsp;"),l.append(e("<li>").html(t.label+"<span>("+t.type+")</span>").data(t))})),l.removeClass("loading")}))};i.find(".siteorigin-widget-autocomplete-input").on("click",(function(){var t=i.find(".existing-content-selector");t.show();var n=new e.Deferred;t.is(":visible")&&0===t.find("ul.items li").length?n=a():n.resolve(),n.done(s)}));var o=function(){i.find(".existing-content-selector").hide()};e(window).on("mousedown",(function(e){0===i.find(e.target).length&&o()})),i.find(".button-close").on("click",o),i.on("click keypress",".items li",(function(t){if(t.preventDefault(),"keyup"!=t.type||window.sowbForms.isEnter(t)){var s=e(this),a=n(),o=s.data("value"),l=a.indexOf(o);l>-1?(a.splice(l,1),s.removeClass("selected")):(a.push(o),s.addClass("selected"));var d=i.find("input.siteorigin-widget-input");d.val(a.join(",")),d.trigger("change")}}));var l=null;i.find(".content-text-search").on("keyup",(function(){null!==l&&clearTimeout(l),l=setTimeout((function(){a()}),500)})),i.data("initialized",!0)}}))}(jQuery);